<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Jason Willwerscheid" />


<title>Revisiting prior families for trees: Part XI</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">drift-workflow</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jhmarcus/drift-workflow">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Revisiting prior families for trees: Part XI</h1>
<h4 class="author">Jason Willwerscheid</h4>
<h4 class="date">7/22/2020</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#report"> Report <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-09-05
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 6 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>drift-workflow/analysis/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.2.0). The <em>Report</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="report" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20190211code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20190211)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20190211code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20190211)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomjhmarcusdriftworkflowtree3f347faab04536513746a45a7bd287bc37ecfb94targetblank3f347faa"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/jhmarcus/drift-workflow/tree/3f347faab04536513746a45a7bd287bc37ecfb94" target="_blank">3f347fa</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomjhmarcusdriftworkflowtree3f347faab04536513746a45a7bd287bc37ecfb94targetblank3f347faa" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility. The version displayed above was the version of the Git repository at the time these results were generated. <br><br> Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    docs/.DS_Store
    Ignored:    docs/assets/.DS_Store
    Ignored:    output/

Untracked files:
    Untracked:  analysis/extrapolate3.Rmd
    Untracked:  analysis/extrapolate4.Rmd
    Untracked:  analysis/pm1_priors_tmp.Rmd

Unstaged changes:
    Modified:   analysis/tree_literature.Rmd
    Modified:   drift-workflow.Rproj

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the R Markdown and HTML files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view them.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/3f347faab04536513746a45a7bd287bc37ecfb94/analysis/pm1_priors11.Rmd" target="_blank">3f347fa</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-05
</td>
<td>
wflow_publish(“analysis/pm1_priors11.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jhmarcus/drift-workflow/ac40b3bc4b519c70824e7c1f972f0adc8a503e38/docs/pm1_priors11.html" target="_blank">ac40b3b</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/40bd6e18edf02bf3e6538ae11c69a8e65c8cfe9a/analysis/pm1_priors11.Rmd" target="_blank">40bd6e1</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
<td>
workflowr::wflow_publish(“analysis/pm1_priors11.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jhmarcus/drift-workflow/f2b82dce8e993742b13129b8ad66d1f911e3824a/docs/pm1_priors11.html" target="_blank">f2b82dc</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/688d5fa5d26e1ee091e50ac25530f5e891facabb/analysis/pm1_priors11.Rmd" target="_blank">688d5fa</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
<td>
wflow_publish(“analysis/pm1_priors11.Rmd”)
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<pre class="r"><code>suppressMessages({
  library(flashier)
  library(drift.alpha)
  library(tidyverse)
})</code></pre>
<p>I run some more experiments on the balanced tree with four populations of equal sizes to try to get a better understanding of what’s going on.</p>
<pre class="r"><code>sim_tree &lt;- function(n_range, 
                     p = 10000, 
                     branch_means, 
                     branch_sds, 
                     resid_sd = 0.1,
                     admix_pops = NULL, 
                     outgroup = FALSE, 
                     seed = 666) {
  set.seed(seed)
  
  depth &lt;- length(branch_means)
  npop_pure &lt;- 2^(depth - 1)

  if (is.null(admix_pops)) {
    admix_pops &lt;- matrix(nrow = 0, ncol = 0)
  }
  npop_admix &lt;- ncol(admix_pops)
  
  npop &lt;- npop_pure + npop_admix + outgroup
  
  if (length(n_range) == 1) {
    n &lt;- rep(n_range, npop)
  } else {
    n &lt;- sample(30:100, npop, replace = TRUE)
  }
  K &lt;- 2^depth - 1
  
  FF &lt;- matrix(nrow = p, ncol = K)
  k &lt;- 1
  for (d in 1:depth) {
    for (i in 1:(2^(d - 1))) {
      FF[, k] &lt;- rnorm(p, sd = branch_means[d] + rnorm(1, sd = branch_sds[d]))
      k &lt;- k + 1
    }
  }
  
  tree_mat &lt;- matrix(0, nrow = npop_pure, ncol = K)
  k &lt;- 1
  for (d in 1:depth) {
    size &lt;- 2^(depth - d)
    for (i in 1:(2^(d - 1))) {
      tree_mat[((i - 1) * size + 1):(i * size), k] &lt;- 1
      k &lt;- k + 1
    }
  }
  
  pop_means &lt;- FF %*% t(tree_mat)
  if (npop_admix &gt; 0) {
    pop_means &lt;- cbind(pop_means, pop_means %*% admix_pops)
  }
  if (outgroup) {
    pop_means &lt;- cbind(pop_means, rnorm(p, mean = 0, sd = sqrt(sum(branch_sds^2))))
  }
  
  Y &lt;- NULL
  for (i in 1:npop) {
    Y &lt;- rbind(Y, matrix(pop_means[, i], nrow = n[i], ncol = p, byrow = TRUE))
  }
  Y &lt;- Y + rnorm(sum(n) * p, sd = resid_sd)
  
  plot_fl &lt;- function(fl) {
    dr &lt;- init_from_flash(fl)
    sd &lt;- sqrt(dr$prior_s2)
    L &lt;- dr$EL
    LDsqrt &lt;- L %*% diag(sd)
    K &lt;- ncol(LDsqrt)
    plot_loadings(LDsqrt[,1:K], rep(letters[1:npop], n)) +
      scale_color_brewer(palette=&quot;Set3&quot;)
  }
  
  return(list(Y = Y, plot_fn = plot_fl))
}
  
init.mean.factor &lt;- function(resids, zero.idx) {
  u &lt;- matrix(1, nrow = nrow(resids), ncol = 1)
  u[zero.idx, 1] &lt;- 0
  v &lt;- t(solve(crossprod(u), crossprod(u, resids)))
  return(list(u, v))
}

balanced_4pop &lt;- sim_tree(n_range = 50,
                          p = 10000,
                          branch_means = rep(1, 3),
                          branch_sds = rep(0, 3),
                          resid_sd = 0.1)</code></pre>
<p>In an <a href="pm1_priors9.html">earlier analysis</a>, I needed to do a backfit in order to find sparse third and fourth factors via rotation. Ideally, though, the greedy approach would be able to find a sparse third factor. But it doesn’t:</p>
<pre class="r"><code>fl_pl &lt;- flash.init(balanced_4pop$Y) %&gt;%
  flash.set.verbose(0) %&gt;%
  flash.add.greedy(Kmax = 3, 
                   prior.family = c(prior.point.laplace(), prior.normal())) %&gt;%
  flash.backfit(tol = 1e-4, verbose.lvl = 0)

balanced_4pop$plot_fn(fl_pl)</code></pre>
<p><img src="figure/pm1_priors11.Rmd/pl1-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-pl1-1">
Past versions of pl1-1.png
</button>
</p>
<div id="fig-pl1-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/f2b82dce8e993742b13129b8ad66d1f911e3824a/docs/figure/pm1_priors11.Rmd/pl1-1.png" target="_blank">f2b82dc</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is not a convergence issue: if I initialize to a sparse factor (by, for example, keeping only the first three factors from the fit from the previous analysis), I get the same result:</p>
<pre class="r"><code>fl_pl2 &lt;- flash.init(balanced_4pop$Y) %&gt;%
  flash.set.verbose(0) %&gt;%
  flash.add.greedy(Kmax = 4, 
                   prior.family = c(prior.point.laplace(), prior.normal())) %&gt;%
  flash.backfit(tol = 1e-4, verbose.lvl = 0)

fl_pl3 &lt;- fl_pl2 %&gt;% 
  flash.remove.factors(kset = 4) %&gt;%
  flash.backfit(tol = 1e-4, verbose.lvl = 0)

balanced_4pop$plot_fn(fl_pl3)</code></pre>
<p><img src="figure/pm1_priors11.Rmd/pl2-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-pl2-1">
Past versions of pl2-1.png
</button>
</p>
<div id="fig-pl2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/f2b82dce8e993742b13129b8ad66d1f911e3824a/docs/figure/pm1_priors11.Rmd/pl2-1.png" target="_blank">f2b82dc</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>What’s happening is that we’re getting the third principal component and there’s a sufficiently large gap between the third and fourth singular values for the non-sparse third PC to be preferred to a sparse linear combination of the third and fourth PCs.</p>
<pre class="r"><code>svd_res &lt;- svd(balanced_4pop$Y)
cat(&quot;First four singular values:&quot;, round(svd_res$d[1:4]))</code></pre>
<pre><code>#&gt; First four singular values: 1877 1216 713 694</code></pre>
<p>The third PC appears as follows:</p>
<pre class="r"><code>plot(svd_res$u[, 3])</code></pre>
<p><img src="figure/pm1_priors11.Rmd/svd2-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-svd2-1">
Past versions of svd2-1.png
</button>
</p>
<div id="fig-svd2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/f2b82dce8e993742b13129b8ad66d1f911e3824a/docs/figure/pm1_priors11.Rmd/svd2-1.png" target="_blank">f2b82dc</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is not due to residual noise, but (I think) to the fact that the simulated branches aren’t exactly orthogonal. If I remove the noise altogether, I get the same result:</p>
<pre class="r"><code>balanced_4pop_smallsd &lt;- sim_tree(n_range = 50,
                                  p = 10000,
                                  branch_means = rep(1, 3),
                                  branch_sds = rep(0, 3),
                                  resid_sd = 0)

fl_pl4 &lt;- flash.init(balanced_4pop_smallsd$Y) %&gt;%
  flash.set.verbose(0) %&gt;%
  flash.add.greedy(Kmax = 3, 
                   prior.family = c(prior.point.laplace(), prior.normal())) %&gt;%
  flash.backfit(tol = 1e-4, verbose.lvl = 0)

balanced_4pop$plot_fn(fl_pl4)</code></pre>
<p><img src="figure/pm1_priors11.Rmd/sim2-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-sim2-1">
Past versions of sim2-1.png
</button>
</p>
<div id="fig-sim2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/f2b82dce8e993742b13129b8ad66d1f911e3824a/docs/figure/pm1_priors11.Rmd/sim2-1.png" target="_blank">f2b82dc</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If I force the prior to put some mass on the pointmass at zero (here, I fix the mixture proportions at <code>c(0.5, 0.5)</code>), I again get the same result:</p>
<pre class="r"><code>g &lt;- ebnm::laplacemix(pi = c(0.5, 0.5), mean = c(0, 0), scale = c(0, 1))

fl_pl5 &lt;- flash.init(balanced_4pop$Y) %&gt;%
  flash.set.verbose(0) %&gt;%
  flash.add.greedy(Kmax = 3, 
                   prior.family = c(prior.point.laplace(g_init = g, fix_g = TRUE),
                   prior.normal())) %&gt;%
  flash.backfit(tol = 1e-4, verbose.lvl = 0)

balanced_4pop$plot_fn(fl_pl5)</code></pre>
<p><img src="figure/pm1_priors11.Rmd/fixg-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-fixg-1">
Past versions of fixg-1.png
</button>
</p>
<div id="fig-fixg-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/f2b82dce8e993742b13129b8ad66d1f911e3824a/docs/figure/pm1_priors11.Rmd/fixg-1.png" target="_blank">f2b82dc</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The result is the same if I use a sparse initialization. I show the initialization and details for 25 iterations, which is sufficient to get to a non-sparse solution:</p>
<pre class="r"><code>fl_pl6 &lt;- flash.init(balanced_4pop$Y) %&gt;%
  flash.set.verbose(0) %&gt;%
  flash.add.greedy(Kmax = 4, 
                   prior.family = c(prior.point.laplace(g_init = g, fix_g = TRUE),
                   prior.normal())) %&gt;%
  flash.backfit(tol = 1e-3, verbose.lvl = 0) %&gt;%
  flash.remove.factors(kset = 4)

balanced_4pop$plot_fn(fl_pl6)</code></pre>
<p><img src="figure/pm1_priors11.Rmd/fixg2-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-fixg2-1">
Past versions of fixg2-1.png
</button>
</p>
<div id="fig-fixg2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/ac40b3bc4b519c70824e7c1f972f0adc8a503e38/docs/figure/pm1_priors11.Rmd/fixg2-1.png" target="_blank">ac40b3b</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>
verbose.fns &lt;- c(flashier:::calc.obj.diff,
                 function(new, old, k) {
                   round(sum(flashier:::get.KL(new, n = 1)))
                 },
                 function(new, old, k) {
                   round(sum(flashier:::get.KL(new, n = 2)))
                 },
                 function(new, old, k) {
                   round(flashier:::get.obj(new) - 
                           sum(flashier:::get.KL(new, n = 1)) -
                           sum(flashier:::get.KL(new, n = 2)))
                 })
verbose.colnames &lt;- c(&quot;ELBO diff&quot;, &quot;KL-div (L)&quot;, &quot;KL-div (F)&quot;, &quot;fit (llik)&quot;)
verbose.colwidths &lt;- c(12, 14, 14, 14)

fl_pl7 &lt;- fl_pl6 %&gt;% 
  flash.set.verbose(3, verbose.fns, verbose.colnames, verbose.colwidths) %&gt;%
  flash.backfit(tol = 1e-4, verbose.lvl = 3, maxiter = 25)</code></pre>
<pre><code>#&gt; Backfitting 3 factors (tolerance: 1.00e-04)...
#&gt;     Iteration  Factor   ELBO diff    KL-div (L)    KL-div (F)    fit (llik)
#&gt;             1     all    3.48e+04         -3273        -94552      -1476575 
#&gt;             2     all    4.28e+02         -3542        -94231      -1476199 
#&gt;             3     all    9.53e+02         -3592        -94354      -1475073 
#&gt;             4     all    1.11e+03         -3598        -94385      -1473930 
#&gt;             5     all    1.20e+03         -3605        -94411      -1472694 
#&gt;             6     all    1.26e+03         -3613        -94441      -1471393 
#&gt;             7     all    1.21e+03         -3623        -94471      -1470144 
#&gt;             8     all    6.68e+02         -3635        -94497      -1469439 
#&gt;             9     all    2.24e-02         -3634        -94480      -1469457 
#&gt;            10     all    1.76e-02         -3634        -94479      -1469457 
#&gt;            11     all    2.35e-02         -3634        -94480      -1469457 
#&gt;            12     all    2.92e-02         -3634        -94480      -1469457 
#&gt;            13     all    3.16e-02         -3634        -94480      -1469457 
#&gt;            14     all    9.80e-03         -3634        -94480      -1469457 
#&gt;            15     all    2.96e-03         -3634        -94480      -1469457 
#&gt;            16     all    5.46e-03         -3634        -94480      -1469457 
#&gt;            17     all    8.18e-03         -3634        -94480      -1469457 
#&gt;            18     all    1.17e-02         -3634        -94480      -1469457 
#&gt;            19     all    1.61e-02         -3634        -94480      -1469457 
#&gt;            20     all    1.41e-02         -3634        -94480      -1469457 
#&gt;            21     all    2.19e-03         -3634        -94480      -1469457 
#&gt;            22     all    4.07e-03         -3634        -94480      -1469457 
#&gt;            23     all    6.16e-03         -3634        -94480      -1469457 
#&gt;            24     all    8.97e-03         -3634        -94480      -1469457 
#&gt;            25     all    1.27e-02         -3634        -94480      -1469457 
#&gt;   --Maximum number of iterations reached!
#&gt;   Backfit complete. Objective: -1567570.423 
#&gt; Wrapping up...
#&gt; Done.</code></pre>
<pre class="r"><code>
balanced_4pop$plot_fn(fl_pl7)</code></pre>
<p><img src="figure/pm1_priors11.Rmd/fixg2-2.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-fixg2-2">
Past versions of fixg2-2.png
</button>
</p>
<div id="fig-fixg2-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/jhmarcus/drift-workflow/blob/ac40b3bc4b519c70824e7c1f972f0adc8a503e38/docs/figure/pm1_priors11.Rmd/fixg2-2.png" target="_blank">ac40b3b</a>
</td>
<td>
Jason Willwerscheid
</td>
<td>
2020-09-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There doesn’t appear to be a good way to get a sparse third factor using a greedy approach. Backfitting might be necessary.</p>
<div id="appendix" class="section level2">
<h2>Appendix</h2>
<p>For contrast, I show the per-iteration progress for the four-factor backfit:</p>
<pre class="r"><code>fl_bf &lt;- flash.init(balanced_4pop$Y) %&gt;%
  flash.set.verbose(0) %&gt;%
  flash.add.greedy(Kmax = 4, 
                   prior.family = c(prior.point.laplace(), prior.normal())) %&gt;%
  flash.set.verbose(3, verbose.fns, verbose.colnames, verbose.colwidths) %&gt;%
  flash.backfit(tol = 1e-4)</code></pre>
<pre><code>#&gt; Backfitting 4 factors (tolerance: 1.00e-04)...
#&gt;     Iteration  Factor   ELBO diff    KL-div (L)    KL-div (F)    fit (llik)
#&gt;             1     all    6.34e+05         -5176       -171337       1746838 
#&gt;             2     all    5.91e+03         -5539       -189448       1771222 
#&gt;             3     all    3.74e+02         -5466       -185796       1767871 
#&gt;             4     all    3.20e+00         -5458       -185393       1767464 
#&gt;             5     all    4.16e-02         -5459       -185427       1767498 
#&gt;             6     all    2.82e-03         -5459       -185435       1767507 
#&gt;             7     all    1.90e-03         -5459       -185435       1767506 
#&gt;             8     all    3.12e-03         -5459       -185434       1767506 
#&gt;             9     all    5.89e-03         -5459       -185434       1767506 
#&gt;            10     all    1.21e-02         -5459       -185434       1767506 
#&gt;            11     all    2.44e-02         -5459       -185434       1767506 
#&gt;            12     all    4.92e-02         -5459       -185434       1767506 
#&gt;            13     all    9.88e-02         -5459       -185434       1767506 
#&gt;            14     all    1.98e-01         -5459       -185434       1767506 
#&gt;            15     all    3.98e-01         -5458       -185434       1767506 
#&gt;            16     all    8.03e-01         -5457       -185434       1767506 
#&gt;            17     all    1.63e+00         -5456       -185434       1767506 
#&gt;            18     all    3.35e+00         -5452       -185435       1767506 
#&gt;            19     all    6.83e+00         -5445       -185435       1767506 
#&gt;            20     all    3.53e+00         -5428       -185447       1767505 
#&gt;            21     all    2.95e+00         -5428       -185445       1767506 
#&gt;            22     all    1.92e-02         -5428       -185445       1767506 
#&gt;            23     all    3.26e-02         -5428       -185445       1767506 
#&gt;            24     all    5.63e-02         -5428       -185445       1767506 
#&gt;            25     all    1.06e-01         -5428       -185445       1767506 
#&gt;            26     all    2.20e-01         -5428       -185445       1767506 
#&gt;            27     all    4.42e-01         -5428       -185445       1767506 
#&gt;            28     all    8.60e-01         -5428       -185444       1767506 
#&gt;            29     all    1.60e+00         -5428       -185442       1767506 
#&gt;            30     all    2.70e+00         -5428       -185440       1767506 
#&gt;            31     all    3.36e+00         -5427       -185437       1767506 
#&gt;            32     all    1.33e-03         -5427       -185437       1767506 
#&gt;            33     all    2.66e-03         -5427       -185437       1767506 
#&gt;            34     all    4.51e-03         -5427       -185437       1767506 
#&gt;            35     all    7.81e-03         -5427       -185437       1767506 
#&gt;            36     all    1.48e-02         -5427       -185437       1767506 
#&gt;            37     all    3.08e-02         -5427       -185437       1767506 
#&gt;            38     all    6.24e-02         -5427       -185437       1767506 
#&gt;            39     all    1.24e-01         -5427       -185437       1767506 
#&gt;            40     all    2.41e-01         -5427       -185437       1767506 
#&gt;            41     all    4.52e-01         -5427       -185436       1767506 
#&gt;            42     all    7.78e-01         -5426       -185436       1767506 
#&gt;            43     all    1.05e+00         -5425       -185436       1767506 
#&gt;            44     all    6.14e-02         -5423       -185438       1767506 
#&gt;            45     all    3.34e-03         -5423       -185438       1767506 
#&gt;            46     all    6.67e-03         -5423       -185438       1767506 
#&gt;            47     all    1.13e-02         -5423       -185438       1767506 
#&gt;            48     all    1.96e-02         -5423       -185438       1767506 
#&gt;            49     all    3.69e-02         -5423       -185438       1767506 
#&gt;            50     all    7.65e-02         -5423       -185438       1767506 
#&gt;            51     all    1.54e-01         -5423       -185438       1767506 
#&gt;            52     all    3.00e-01         -5423       -185437       1767506 
#&gt;            53     all    5.59e-01         -5423       -185437       1767506 
#&gt;            54     all    9.50e-01         -5423       -185436       1767506 
#&gt;            55     all    1.22e+00         -5422       -185436       1767506 
#&gt;            56     all    8.81e-04         -5422       -185436       1767506 
#&gt;            57     all    1.77e-03         -5422       -185436       1767506 
#&gt;            58     all    3.00e-03         -5422       -185436       1767506 
#&gt;            59     all    5.20e-03         -5422       -185436       1767506 
#&gt;            60     all    9.86e-03         -5422       -185436       1767506 
#&gt;            61     all    2.06e-02         -5422       -185436       1767506 
#&gt;            62     all    4.18e-02         -5422       -185436       1767506 
#&gt;            63     all    8.39e-02         -5422       -185436       1767506 
#&gt;            64     all    1.66e-01         -5422       -185436       1767506 
#&gt;            65     all    3.22e-01         -5422       -185436       1767506 
#&gt;            66     all    6.04e-01         -5421       -185435       1767506 
#&gt;            67     all    1.04e+00         -5420       -185435       1767506 
#&gt;            68     all    1.43e+00         -5418       -185436       1767506 
#&gt;            69     all    2.33e-01         -5414       -185440       1767506 
#&gt;            70     all    7.49e-03         -5414       -185440       1767506 
#&gt;            71     all    1.49e-02         -5414       -185440       1767506 
#&gt;            72     all    2.53e-02         -5414       -185440       1767506 
#&gt;            73     all    4.38e-02         -5414       -185440       1767506 
#&gt;            74     all    8.26e-02         -5414       -185440       1767506 
#&gt;            75     all    1.70e-01         -5414       -185440       1767506 
#&gt;            76     all    3.40e-01         -5414       -185440       1767506 
#&gt;            77     all    6.56e-01         -5413       -185439       1767506 
#&gt;            78     all    1.19e+00         -5413       -185438       1767506 
#&gt;            79     all    1.88e+00         -5413       -185437       1767506 
#&gt;            80     all    1.74e+00         -5412       -185435       1767506 
#&gt;            81     all    1.24e-03         -5412       -185435       1767506 
#&gt;            82     all    2.48e-03         -5412       -185435       1767506 
#&gt;            83     all    4.21e-03         -5412       -185435       1767506 
#&gt;            84     all    7.29e-03         -5412       -185435       1767506 
#&gt;            85     all    1.38e-02         -5412       -185435       1767506 
#&gt;            86     all    2.87e-02         -5412       -185435       1767506 
#&gt;            87     all    5.82e-02         -5412       -185435       1767506 
#&gt;            88     all    1.16e-01         -5412       -185435       1767506 
#&gt;            89     all    2.24e-01         -5412       -185435       1767506 
#&gt;            90     all    4.17e-01         -5412       -185435       1767506 
#&gt;            91     all    7.05e-01         -5411       -185435       1767506 
#&gt;            92     all    8.96e-01         -5410       -185435       1767506 
#&gt;            93     all    1.44e-03         -5410       -185435       1767506 
#&gt;            94     all    2.88e-03         -5410       -185435       1767506 
#&gt;            95     all    4.89e-03         -5410       -185435       1767506 
#&gt;            96     all    8.47e-03         -5410       -185435       1767506 
#&gt;            97     all    1.60e-02         -5410       -185435       1767506 
#&gt;            98     all    3.32e-02         -5410       -185435       1767506 
#&gt;            99     all    6.70e-02         -5410       -185435       1767506 
#&gt;           100     all    1.32e-01         -5410       -185435       1767506 
#&gt;           101     all    2.52e-01         -5410       -185435       1767506 
#&gt;           102     all    4.51e-01         -5409       -185435       1767506 
#&gt;           103     all    6.85e-01         -5409       -185435       1767506 
#&gt;           104     all    5.06e-01         -5407       -185436       1767506 
#&gt;           105     all    2.19e-03         -5407       -185436       1767506 
#&gt;           106     all    4.37e-03         -5407       -185436       1767506 
#&gt;           107     all    7.41e-03         -5407       -185436       1767506 
#&gt;           108     all    1.28e-02         -5407       -185436       1767506 
#&gt;           109     all    2.42e-02         -5407       -185436       1767506 
#&gt;           110     all    5.01e-02         -5407       -185436       1767506 
#&gt;           111     all    1.00e-01         -5407       -185436       1767506 
#&gt;           112     all    1.95e-01         -5407       -185436       1767506 
#&gt;           113     all    3.62e-01         -5407       -185435       1767506 
#&gt;           114     all    6.06e-01         -5407       -185435       1767506 
#&gt;           115     all    7.33e-01         -5406       -185435       1767506 
#&gt;           116     all    9.54e-04         -5406       -185435       1767506 
#&gt;           117     all    1.91e-03         -5406       -185435       1767506 
#&gt;           118     all    3.24e-03         -5406       -185435       1767506 
#&gt;           119     all    5.62e-03         -5406       -185435       1767506 
#&gt;           120     all    1.07e-02         -5406       -185435       1767506 
#&gt;           121     all    2.22e-02         -5406       -185435       1767506 
#&gt;           122     all    4.53e-02         -5406       -185435       1767506 
#&gt;           123     all    9.11e-02         -5406       -185435       1767506 
#&gt;           124     all    1.81e-01         -5406       -185435       1767506 
#&gt;           125     all    3.56e-01         -5405       -185435       1767506 
#&gt;           126     all    6.85e-01         -5405       -185435       1767506 
#&gt;           127     all    1.26e+00         -5403       -185435       1767506 
#&gt;           128     all    2.05e+00         -5401       -185436       1767506 
#&gt;           129     all    2.26e+00         -5395       -185439       1767506 
#&gt;           130     all    8.03e-03         -5395       -185439       1767506 
#&gt;           131     all    1.60e-02         -5395       -185439       1767506 
#&gt;           132     all    2.72e-02         -5395       -185439       1767506 
#&gt;           133     all    4.69e-02         -5395       -185439       1767506 
#&gt;           134     all    8.83e-02         -5395       -185439       1767506 
#&gt;           135     all    1.82e-01         -5395       -185439       1767506 
#&gt;           136     all    3.62e-01         -5395       -185439       1767506 
#&gt;           137     all    6.91e-01         -5395       -185438       1767506 
#&gt;           138     all    1.23e+00         -5394       -185437       1767506 
#&gt;           139     all    1.83e+00         -5394       -185436       1767506 
#&gt;           140     all    1.12e+00         -5393       -185435       1767506 
#&gt;           141     all    1.47e-03         -5393       -185435       1767506 
#&gt;           142     all    2.94e-03         -5393       -185435       1767506 
#&gt;           143     all    5.00e-03         -5393       -185435       1767506 
#&gt;           144     all    8.66e-03         -5393       -185435       1767506 
#&gt;           145     all    1.64e-02         -5393       -185435       1767506 
#&gt;           146     all    3.41e-02         -5393       -185435       1767506 
#&gt;           147     all    6.90e-02         -5393       -185435       1767506 
#&gt;           148     all    1.37e-01         -5393       -185435       1767506 
#&gt;           149     all    2.65e-01         -5393       -185435       1767506 
#&gt;           150     all    4.92e-01         -5392       -185435       1767506 
#&gt;           151     all    8.25e-01         -5392       -185435       1767506 
#&gt;           152     all    1.01e+00         -5390       -185436       1767506 
#&gt;           153     all    2.09e-03         -5390       -185436       1767506 
#&gt;           154     all    4.17e-03         -5390       -185436       1767506 
#&gt;           155     all    7.08e-03         -5390       -185436       1767506 
#&gt;           156     all    1.23e-02         -5390       -185436       1767506 
#&gt;           157     all    2.32e-02         -5390       -185436       1767506 
#&gt;           158     all    4.80e-02         -5390       -185436       1767506 
#&gt;           159     all    9.66e-02         -5390       -185436       1767506 
#&gt;           160     all    1.89e-01         -5390       -185435       1767506 
#&gt;           161     all    3.58e-01         -5390       -185435       1767506 
#&gt;           162     all    6.25e-01         -5389       -185435       1767506 
#&gt;           163     all    8.85e-01         -5388       -185435       1767506 
#&gt;           164     all    3.05e-01         -5387       -185437       1767506 
#&gt;           165     all    3.43e-03         -5387       -185437       1767506 
#&gt;           166     all    6.86e-03         -5387       -185437       1767506 
#&gt;           167     all    1.16e-02         -5387       -185437       1767506 
#&gt;           168     all    2.01e-02         -5387       -185437       1767506 
#&gt;           169     all    3.79e-02         -5386       -185436       1767506 
#&gt;           170     all    7.85e-02         -5386       -185436       1767506 
#&gt;           171     all    1.57e-01         -5386       -185436       1767506 
#&gt;           172     all    3.04e-01         -5386       -185436       1767506 
#&gt;           173     all    5.58e-01         -5386       -185436       1767506 
#&gt;           174     all    9.09e-01         -5386       -185435       1767506 
#&gt;           175     all    9.81e-01         -5385       -185435       1767506 
#&gt;           176     all    1.28e-03         -5385       -185435       1767506 
#&gt;           177     all    2.57e-03         -5385       -185435       1767506 
#&gt;           178     all    4.36e-03         -5385       -185435       1767506 
#&gt;           179     all    7.56e-03         -5385       -185435       1767506 
#&gt;           180     all    1.43e-02         -5385       -185435       1767506 
#&gt;           181     all    2.99e-02         -5385       -185435       1767506 
#&gt;           182     all    6.09e-02         -5385       -185435       1767506 
#&gt;           183     all    1.22e-01         -5385       -185435       1767506 
#&gt;           184     all    2.42e-01         -5384       -185435       1767506 
#&gt;           185     all    4.74e-01         -5384       -185435       1767506 
#&gt;           186     all    8.98e-01         -5383       -185435       1767506 
#&gt;           187     all    1.60e+00         -5381       -185435       1767506 
#&gt;           188     all    2.39e+00         -5377       -185437       1767506 
#&gt;           189     all    1.59e+00         -5370       -185443       1767506 
#&gt;           190     all    1.34e-02         -5370       -185443       1767506 
#&gt;           191     all    2.68e-02         -5370       -185443       1767506 
#&gt;           192     all    4.54e-02         -5370       -185443       1767506 
#&gt;           193     all    7.84e-02         -5370       -185443       1767506 
#&gt;           194     all    1.48e-01         -5370       -185442       1767506 
#&gt;           195     all    3.04e-01         -5370       -185442       1767506 
#&gt;           196     all    6.04e-01         -5370       -185442       1767506 
#&gt;           197     all    1.15e+00         -5370       -185441       1767506 
#&gt;           198     all    2.04e+00         -5369       -185439       1767506 
#&gt;           199     all    3.00e+00         -5369       -185436       1767506 
#&gt;           200     all    1.64e+00         -5368       -185436       1767506 
#&gt;           201     all    2.14e-03         -5368       -185436       1767506 
#&gt;           202     all    4.27e-03         -5368       -185436       1767506 
#&gt;           203     all    7.25e-03         -5368       -185436       1767506 
#&gt;           204     all    1.26e-02         -5368       -185436       1767506 
#&gt;           205     all    2.37e-02         -5368       -185436       1767506 
#&gt;           206     all    4.94e-02         -5368       -185436       1767506 
#&gt;           207     all    9.97e-02         -5368       -185436       1767506 
#&gt;           208     all    1.97e-01         -5368       -185436       1767506 
#&gt;           209     all    3.80e-01         -5367       -185435       1767506 
#&gt;           210     all    6.93e-01         -5367       -185435       1767506 
#&gt;           211     all    1.12e+00         -5366       -185435       1767506 
#&gt;           212     all    1.16e+00         -5363       -185436       1767506 
#&gt;           213     all    3.17e-03         -5363       -185436       1767506 
#&gt;           214     all    6.32e-03         -5363       -185436       1767506 
#&gt;           215     all    1.07e-02         -5363       -185436       1767506 
#&gt;           216     all    1.86e-02         -5363       -185436       1767506 
#&gt;           217     all    3.51e-02         -5363       -185436       1767506 
#&gt;           218     all    7.26e-02         -5363       -185436       1767506 
#&gt;           219     all    1.46e-01         -5363       -185436       1767506 
#&gt;           220     all    2.85e-01         -5363       -185436       1767506 
#&gt;           221     all    5.34e-01         -5363       -185436       1767506 
#&gt;           222     all    9.16e-01         -5362       -185435       1767506 
#&gt;           223     all    1.21e+00         -5361       -185435       1767506 
#&gt;           224     all    1.59e-03         -5361       -185435       1767506 
#&gt;           225     all    3.17e-03         -5361       -185435       1767506 
#&gt;           226     all    5.39e-03         -5361       -185435       1767506 
#&gt;           227     all    9.34e-03         -5361       -185435       1767506 
#&gt;           228     all    1.77e-02         -5361       -185435       1767506 
#&gt;           229     all    3.70e-02         -5361       -185435       1767506 
#&gt;           230     all    7.54e-02         -5361       -185435       1767506 
#&gt;           231     all    1.52e-01         -5361       -185435       1767506 
#&gt;           232     all    3.03e-01         -5361       -185435       1767506 
#&gt;           233     all    5.99e-01         -5360       -185435       1767506 
#&gt;           234     all    1.16e+00         -5359       -185435       1767506 
#&gt;           235     all    1.36e+00         -5357       -185436       1767506 
#&gt;           236     all    2.09e-03         -5357       -185436       1767506 
#&gt;           237     all    4.17e-03         -5357       -185436       1767506 
#&gt;           238     all    7.06e-03         -5357       -185436       1767506 
#&gt;           239     all    1.22e-02         -5357       -185436       1767506 
#&gt;           240     all    2.17e+02         -5005       -185435       1767371 
#&gt;           241     all    1.74e+02         -4952       -185433       1767489 
#&gt;           242     all    5.10e-01         -4952       -185438       1767494 
#&gt;           243     all    1.43e+01         -4952       -185435       1767506 
#&gt;           244     all    1.55e-02         -4952       -185436       1767507 
#&gt;           245     all    1.34e-02         -4952       -185436       1767506 
#&gt;           246     all    2.43e-02         -4952       -185435       1767506 
#&gt;           247     all    1.87e+01         -4932       -185435       1767505 
#&gt;           248     all    1.35e+02         -4798       -185435       1767507 
#&gt;           249     all    2.09e+00         -4798       -185435       1767509 
#&gt;           250     all    2.06e-03         -4799       -185435       1767509 
#&gt;           251     all    5.12e-04         -4799       -185436       1767509 
#&gt;           252     all    7.19e-04         -4798       -185435       1767509 
#&gt;           253     all    8.78e-04         -4798       -185435       1767509 
#&gt;           254     all    1.13e-03         -4798       -185435       1767509 
#&gt;           255     all    1.53e-03         -4798       -185435       1767509 
#&gt;           256     all    2.27e-03         -4798       -185435       1767509 
#&gt;           257     all    3.75e-03         -4798       -185435       1767509 
#&gt;           258     all    7.05e-03         -4798       -185435       1767509 
#&gt;           259     all    1.43e-02         -4798       -185435       1767509 
#&gt;           260     all    2.84e-02         -4798       -185435       1767509 
#&gt;           261     all    5.47e-02         -4798       -185435       1767509 
#&gt;           262     all    1.00e-01         -4798       -185435       1767509 
#&gt;           263     all    1.63e-01         -4798       -185435       1767509 
#&gt;           264     all    1.73e-01         -4798       -185436       1767509 
#&gt;           265     all    2.26e+02         -4551       -185437       1767490 
#&gt;           266     all    3.24e+01         -4543       -185437       1767513 
#&gt;           267     all    3.35e-02         -4542       -185438       1767514 
#&gt;           268     all    2.71e-01         -4542       -185437       1767514 
#&gt;           269     all    3.06e-03         -4542       -185437       1767514 
#&gt;           270     all    2.87e-03         -4542       -185437       1767514 
#&gt;           271     all    5.58e-03         -4542       -185437       1767514 
#&gt;           272     all    1.13e-02         -4542       -185437       1767514 
#&gt;           273     all    2.23e-02         -4542       -185437       1767514 
#&gt;           274     all    4.30e-02         -4542       -185437       1767514 
#&gt;           275     all    7.87e-02         -4542       -185437       1767514 
#&gt;           276     all    1.28e-01         -4542       -185437       1767514 
#&gt;           277     all    1.36e-01         -4542       -185437       1767514 
#&gt;           278     all    2.35e-05         -4542       -185437       1767514 
#&gt;   Backfit complete. Objective: 1577534.959 
#&gt; Wrapping up...
#&gt; Done.</code></pre>
<pre class="r"><code>
balanced_4pop$plot_fn(fl_bf)</code></pre>
<img src="figure/pm1_priors11.Rmd/bf-1.png" width="480" style="display: block; margin: auto;" /> <br> <br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>#&gt; R version 3.5.3 (2019-03-11)
#&gt; Platform: x86_64-apple-darwin15.6.0 (64-bit)
#&gt; Running under: macOS Mojave 10.14.6
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
#&gt; 
#&gt; locale:
#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] forcats_0.4.0      stringr_1.4.0      dplyr_0.8.0.1     
#&gt;  [4] purrr_0.3.2        readr_1.3.1        tidyr_0.8.3       
#&gt;  [7] tibble_2.1.1       ggplot2_3.2.0      tidyverse_1.2.1   
#&gt; [10] drift.alpha_0.0.10 flashier_0.2.7    
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.4.6       lubridate_1.7.4    invgamma_1.1      
#&gt;  [4] lattice_0.20-38    assertthat_0.2.1   rprojroot_1.3-2   
#&gt;  [7] digest_0.6.18      truncnorm_1.0-8    R6_2.4.0          
#&gt; [10] cellranger_1.1.0   plyr_1.8.4         backports_1.1.3   
#&gt; [13] evaluate_0.13      httr_1.4.0         pillar_1.3.1      
#&gt; [16] rlang_0.4.2        lazyeval_0.2.2     readxl_1.3.1      
#&gt; [19] rstudioapi_0.10    ebnm_0.1-21        irlba_2.3.3       
#&gt; [22] whisker_0.3-2      Matrix_1.2-15      rmarkdown_1.12    
#&gt; [25] labeling_0.3       munsell_0.5.0      mixsqp_0.3-40     
#&gt; [28] broom_0.5.1        compiler_3.5.3     modelr_0.1.5      
#&gt; [31] xfun_0.6           pkgconfig_2.0.2    SQUAREM_2017.10-1 
#&gt; [34] htmltools_0.3.6    tidyselect_0.2.5   workflowr_1.2.0   
#&gt; [37] withr_2.1.2        crayon_1.3.4       grid_3.5.3        
#&gt; [40] nlme_3.1-137       jsonlite_1.6       gtable_0.3.0      
#&gt; [43] git2r_0.25.2       magrittr_1.5       scales_1.0.0      
#&gt; [46] cli_1.1.0          stringi_1.4.3      reshape2_1.4.3    
#&gt; [49] fs_1.2.7           xml2_1.2.0         generics_0.0.2    
#&gt; [52] RColorBrewer_1.1-2 tools_3.5.3        glue_1.3.1        
#&gt; [55] hms_0.4.2          parallel_3.5.3     yaml_2.2.0        
#&gt; [58] colorspace_1.4-1   ashr_2.2-51        rvest_0.3.4       
#&gt; [61] knitr_1.22         haven_2.1.1</code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
